<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒè¯•ç­¾åˆ°æŸ¥è¯¢ç³»ç»Ÿ</title>
    <!-- Tailwind CSS - ä½¿ç”¨å®˜æ–¹CDNï¼Œæ·»åŠ å¤‡ç”¨æ–¹æ¡ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- html2canvas - å¼‚æ­¥åŠ è½½ï¼Œæå‡é¡µé¢åŠ è½½é€Ÿåº¦ -->
    <script>
        // å¼‚æ­¥åŠ è½½html2canvasï¼Œæå‡é¡µé¢åŠ è½½æ€§èƒ½
        (function() {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
            script.async = true;
            script.onload = function() {
                console.log('html2canvas loaded successfully');
            };
            script.onerror = function() {
                console.warn('html2canvas failed to load');
            };
            document.head.appendChild(script);
        })();
    </script>

    <!-- GitHub Pages å…¼å®¹æ€§è„šæœ¬ -->
    <script>
        // æ£€æŸ¥èµ„æºæ˜¯å¦åŠ è½½æˆåŠŸï¼Œå¦‚æœå¤±è´¥åˆ™æä¾›fallback
        window.addEventListener('load', function() {
            setTimeout(function() {
                // æ£€æŸ¥html2canvasæ˜¯å¦åŠ è½½æˆåŠŸ
                if (typeof html2canvas === 'undefined') {
                    console.warn('html2canvas CDN failed, screenshot feature will be disabled');
                    // ä¿®æ”¹ä¿å­˜æŒ‰é’®çš„æç¤º
                    const saveBtn = document.querySelector('button[onclick="saveAsImage()"]');
                    if (saveBtn) {
                        saveBtn.onclick = function() {
                            alert('æˆªå›¾åŠŸèƒ½ä¸å¯ç”¨ï¼Œè¯·ç›´æ¥æˆªå–æµè§ˆå™¨ç”»é¢æˆ–ä½¿ç”¨æ‰“å°åŠŸèƒ½');
                        };
                        saveBtn.innerHTML = '<span class="mr-1">ğŸ“·</span>æˆªå›¾åŠŸèƒ½ä¸å¯ç”¨';
                    }
                }

                // æ£€æŸ¥Tailwind CSSæ˜¯å¦åŠ è½½æˆåŠŸ
                if (!document.querySelector('[class*="bg-blue-50"]') ||
                    getComputedStyle(document.body).backgroundColor === '') {
                    console.warn('Tailwind CSS may not be loading properly, applying basic styles...');
                    // åº”ç”¨åŸºæœ¬æ ·å¼fallback
                    applyBasicStyles();
                }
            }, 2000);
        });

        // åº”ç”¨åŸºæœ¬æ ·å¼ä½œä¸ºfallback
        function applyBasicStyles() {
            const style = document.createElement('style');
            style.textContent = `
                /* Basic fallback styles for better GitHub Pages compatibility */
                body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
                .bg-blue-50 { background-color: #eff6ff !important; }
                .bg-green-50 { background-color: #f0fdf4 !important; }
                .bg-purple-50 { background-color: #faf5ff !important; }
                .bg-orange-50 { background-color: #fff7ed !important; }
                .bg-blue-500 { background-color: #3b82f6 !important; }
                .bg-green-600 { background-color: #16a34a !important; }
                .bg-indigo-600 { background-color: #4f46e5 !important; }
                .bg-white { background-color: white !important; }
                .bg-gray-50 { background-color: #f9fafb !important; }
                .text-white { color: white !important; }
                .text-gray-800 { color: #1f2937 !important; }
                .text-gray-600 { color: #4b5563 !important; }
                .text-gray-500 { color: #6b7280 !important; }
                .text-indigo-600 { color: #4f46e5 !important; }
                .text-indigo-800 { color: #3730a3 !important; }
                .border-gray-200 { border-color: #e5e7eb !important; }
                .rounded-lg { border-radius: 0.5rem !important; }
                .rounded-xl { border-radius: 0.75rem !important; }
                .p-4 { padding: 1rem !important; }
                .p-6 { padding: 1.5rem !important; }
                .mb-4 { margin-bottom: 1rem !important; }
                .mb-6 { margin-bottom: 1.5rem !important; }
                .flex { display: flex !important; }
                .items-center { align-items: center !important; }
                .justify-center { justify-content: center !important; }
                .justify-between { justify-content: space-between !important; }
                .hidden { display: none !important; }
                .text-center { text-align: center !important; }
                .font-bold { font-weight: bold !important; }
                .text-2xl { font-size: 1.5rem !important; line-height: 2rem !important; }
                .text-3xl { font-size: 1.875rem !important; line-height: 2.25rem !important; }
                .text-4xl { font-size: 2.25rem !important; line-height: 2.5rem !important; }
                .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important; }
                .cursor-pointer { cursor: pointer !important; }
                .hover\\:bg-indigo-700:hover { background-color: #4338ca !important; }
                .hover\\:bg-green-700:hover { background-color: #15803d !important; }
                .hover\\:bg-blue-700:hover { background-color: #1d4ed8 !important; }
                .hover\\:bg-gray-700:hover { background-color: #374151 !important; }
            `;
            document.head.appendChild(style);
        }
    </script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* æ‰“å°å’Œæˆªå›¾ä¸“ç”¨æ ·å¼ */
        @media print {
            body {
                background: white !important;
            }
            .print-container {
                background: white !important;
                color: black !important;
                box-shadow: none !important;
                border: 1px solid #ccc !important;
            }
            .print-container h3,
            .print-container h4,
            .print-container span,
            .print-container div {
                color: black !important;
            }
        }
        
        /* æˆªå›¾ä¸“ç”¨æ ·å¼ */
        .print-container {
            background: white !important;
            color: #000000 !important;
            padding: 20px !important;
            border-radius: 8px !important;
        }
        .print-container h3,
        .print-container h4 {
            color: #000000 !important;
            font-weight: bold !important;
        }
        .print-container .text-gray-800,
        .print-container .text-gray-700,
        .print-container .text-gray-600,
        .print-container .text-gray-500 {
            color: #000000 !important;
        }
        .print-container .text-indigo-800 {
            color: #1e40af !important;
            background-color: #dbeafe !important;
        }
        .print-container .border-gray-200 {
            border-color: #000000 !important;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <span class="text-2xl mr-2">ğŸ“š</span>
                    <span class="font-bold text-xl text-indigo-600">è€ƒè¯•ç­¾åˆ°æŸ¥è¯¢ç³»ç»Ÿ</span>
                </div>
                <div class="flex space-x-4">
                    <button onclick="showPage('home')" class="nav-btn px-4 py-2 rounded-lg text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 transition-all duration-200">
                        <span class="mr-1">ğŸ </span>é¦–é¡µ
                    </button>
                    <button onclick="showPage('search')" class="nav-btn px-4 py-2 rounded-lg text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 transition-all duration-200">
                        <span class="mr-1">ğŸ”</span>æŸ¥è¯¢
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- é¦–é¡µ -->
    <div id="home" class="page active fade-in">
        <div class="max-w-4xl mx-auto px-4 py-12">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">
                    <span class="text-5xl mr-2">ğŸ“</span>è€ƒè¯•ç­¾åˆ°æŸ¥è¯¢ç³»ç»Ÿ
                </h1>
                <p class="text-lg text-gray-600">å¿«é€ŸæŸ¥è¯¢å­¦ç”Ÿè€ƒè¯•ä¿¡æ¯å’Œç­¾åˆ°çŠ¶æ€</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8 mb-12">
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="text-4xl mb-4 text-center">ğŸ‘¨â€ğŸ“</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2 text-center">å­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢</h3>
                    <p class="text-gray-600 text-center mb-4">é€šè¿‡å§“åæˆ–å­¦å·å¿«é€ŸæŸ¥è¯¢å­¦ç”Ÿè€ƒè¯•ä¿¡æ¯</p>
                    <button onclick="showPage('search')" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors duration-200">
                        å¼€å§‹æŸ¥è¯¢
                    </button>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="text-4xl mb-4 text-center">ğŸ“Š</div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-2 text-center">æ•°æ®ç»Ÿè®¡</h3>
                    <p class="text-gray-600 text-center mb-4">æŸ¥çœ‹è€ƒè¯•æ•°æ®ç»Ÿè®¡å’Œåˆ†æ</p>
                    <button onclick="loadStats()" class="w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors duration-200">
                        æŸ¥çœ‹ç»Ÿè®¡
                    </button>
                </div>
            </div>

            <div id="statsContainer" class="bg-white rounded-xl shadow-lg p-6 hidden">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">
                    <span class="mr-2">ğŸ“ˆ</span>æ•°æ®ç»Ÿè®¡
                </h3>
                <div id="statsContent" class="grid md:grid-cols-3 gap-4">
                    <!-- ç»Ÿè®¡æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </div>
    </div>

    <!-- æŸ¥è¯¢é¡µ -->
    <div id="search" class="page">
        <div class="max-w-4xl mx-auto px-4 py-12">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <span class="mr-2">ğŸ”</span>å­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢
                </h2>
                
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">å§“å</label>
                        <input type="text" id="nameInput" placeholder="è¯·è¾“å…¥å®Œæ•´å§“å" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">å­¦å·</label>
                        <input type="text" id="idInput" placeholder="è¯·è¾“å…¥å®Œæ•´å­¦å·" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>

                    <div class="flex items-end">
                        <button onclick="searchStudent()" class="w-full bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200">
                            æŸ¥è¯¢
                        </button>
                    </div>
                </div>

                <!-- é«˜çº§ç­›é€‰ -->
                <div id="advancedFilters" class="bg-gray-50 rounded-lg p-4 mb-4 hidden">
                    <h4 class="text-md font-semibold mb-3 flex items-center">
                        <span class="mr-2">ğŸ”</span>é«˜çº§ç­›é€‰
                        <button onclick="toggleFilters()" class="ml-auto text-sm text-gray-500 hover:text-gray-700">æ”¶èµ·</button>
                    </h4>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-1">æŒ‰è¯¾ç¨‹ç­›é€‰</label>
                            <select id="courseFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="">å…¨éƒ¨è¯¾ç¨‹</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-1">æŒ‰å­¦é™¢ç­›é€‰</label>
                            <select id="collegeFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="">å…¨éƒ¨å­¦é™¢</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-medium mb-1">æŒ‰è€ƒè¯•æ—¶é—´ç­›é€‰</label>
                            <select id="timeFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="">å…¨éƒ¨æ—¶é—´</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-3 flex gap-2">
                        <button onclick="applyFilters()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors duration-200">
                            åº”ç”¨ç­›é€‰
                        </button>
                        <button onclick="clearFilters()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors duration-200">
                            æ¸…é™¤ç­›é€‰
                        </button>
                    </div>
                </div>

                <div class="text-sm text-gray-600 mb-4">
                    <button onclick="toggleFilters()" class="ml-4 text-indigo-600 hover:text-indigo-800 underline">
                        é«˜çº§ç­›é€‰
                    </button>
                </div>
                
                <div class="text-sm text-gray-600 mb-4">
                    <span class="mr-2">ğŸ’¡</span>æç¤ºï¼šè¯·è¾“å…¥å®Œæ•´çš„å§“åå’Œå­¦å·è¿›è¡Œç²¾ç¡®æŸ¥è¯¢ï¼Œä¸¤ä¸ªå­—æ®µéƒ½å¿…é¡»æ­£ç¡®å¡«å†™
                </div>
            </div>

            <!-- æŸ¥è¯¢ç»“æœ -->
            <div id="searchResults" class="bg-white rounded-xl shadow-lg p-6 hidden print-container">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">
                        <span class="mr-2">ğŸ“‹</span>æŸ¥è¯¢ç»“æœ
                    </h3>
                    <div class="flex gap-2">
                        <button onclick="saveAsImage()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors duration-200">
                            <span class="mr-1">ğŸ“·</span>ä¿å­˜ä¸ºå›¾ç‰‡
                        </button>
                        <!-- æš‚æ—¶æ³¨é‡Šæ‰å¯¼å‡ºCSVåŠŸèƒ½
                        <button onclick="exportToCSV()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                            <span class="mr-1">ğŸ“„</span>å¯¼å‡ºCSV
                        </button>
                        -->
                    </div>
                </div>
                <div id="resultsContent">
                    <!-- æŸ¥è¯¢ç»“æœå°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½æç¤º -->
    <div id="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 flex items-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mr-3"></div>
            <span class="text-gray-700">åŠ è½½ä¸­...</span>
        </div>
    </div>

    <!-- éšè—çš„æ‰“å°å…ƒç´ ï¼Œç”¨äºç”Ÿæˆå›¾ç‰‡ -->
    <div id="printElement" class="hidden"></div>

    <script>
        // å…¨å±€å˜é‡
        let examData = [];
        let currentPage = 'home';

        // è§£æè€ƒè¯•æ—¶é—´ï¼Œè¿”å›å¯æ’åºçš„æ—¶é—´æˆ³
        function parseExamTime(timeStr) {
            if (!timeStr || timeStr === 'æœªçŸ¥æ—¶é—´') {
                return Infinity; // æœªçŸ¥æ—¶é—´æ’åœ¨æœ€å
            }

            try {
                // å¤„ç†ç±»ä¼¼ "1æœˆ14æ—¥ä¸‹åˆ15:00-17:00" çš„æ ¼å¼ï¼ˆå·²ç»åŒ…å«24å°æ—¶åˆ¶ï¼‰
                const fullMatch = timeStr.match(/(\d+)æœˆ(\d+)æ—¥(?:ä¸Šåˆ|ä¸‹åˆ|æ™šä¸Š)?(\d+)[ï¼š:](\d+)/);
                if (fullMatch) {
                    const [, month, day, hour, minute] = fullMatch;
                    let hourInt = parseInt(hour);
                    // å¦‚æœæ˜ç¡®æ ‡æ³¨ä¸‹åˆä¸”å°æ—¶å°äº12ï¼ŒåŠ ä¸Š12å°æ—¶
                    if (timeStr.includes('ä¸‹åˆ') && hourInt < 12) {
                        hourInt += 12;
                    }
                    // å¦‚æœå°æ—¶å·²ç»æ˜¯24å°æ—¶åˆ¶æ ¼å¼ï¼Œç›´æ¥ä½¿ç”¨
                    const date = new Date(2025, parseInt(month) - 1, parseInt(day), hourInt, parseInt(minute));
                    return date.getTime();
                }

                // å¤„ç†ç±»ä¼¼ "1æœˆ8æ—¥10ï¼š30-12ï¼š00" çš„æ ¼å¼
                const simpleMatch = timeStr.match(/(\d+)æœˆ(\d+)æ—¥(\d+)ï¼š(\d+)/);
                if (simpleMatch) {
                    const [, month, day, hour, minute] = simpleMatch;
                    const date = new Date(2025, parseInt(month) - 1, parseInt(day), parseInt(hour), parseInt(minute));
                    return date.getTime();
                }

                // å¤„ç†ç±»ä¼¼ "2026å¹´1æœˆ9æ—¥10ï¼š30-11ï¼š30" çš„æ ¼å¼
                const yearMatch = timeStr.match(/(\d{4})å¹´(\d+)æœˆ(\d+)æ—¥(\d+)ï¼š(\d+)/);
                if (yearMatch) {
                    const [, year, month, day, hour, minute] = yearMatch;
                    const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day), parseInt(hour), parseInt(minute));
                    return date.getTime();
                }

                // å¤„ç†å…¶ä»–å¯èƒ½çš„æ ¼å¼ï¼Œå°è¯•æå–æœˆæ—¥æ—¶åˆ†
                const generalMatch = timeStr.match(/(\d+)æœˆ(\d+)æ—¥.*(\d+)[ï¼š:](\d+)/);
                if (generalMatch) {
                    const [, month, day, hour, minute] = generalMatch;
                    // ä¿®æ­£å¯èƒ½çš„é”™è¯¯åˆ†é’Ÿæ•°ï¼ˆå¦‚300åˆ†é’Ÿï¼‰
                    let minuteInt = parseInt(minute);
                    if (minuteInt >= 60) {
                        minuteInt = 30; // å‡è®¾æ˜¯30åˆ†é’Ÿ
                    }
                    const date = new Date(2025, parseInt(month) - 1, parseInt(day), parseInt(hour), minuteInt);
                    return date.getTime();
                }

                // å¦‚æœæ— æ³•è§£æï¼Œè¿”å›ä¸€ä¸ªå¤§çš„æ—¶é—´æˆ³
                return Date.now() + 1000000000000;
            } catch (e) {
                console.warn('æ—¶é—´è§£æå¤±è´¥:', timeStr, e);
                return Date.now() + 1000000000000;
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ– - ä¼˜åŒ–åŠ è½½é€Ÿåº¦
        document.addEventListener('DOMContentLoaded', function() {
            // å»¶è¿ŸåŠ è½½æ•°æ®ï¼Œæå‡åˆå§‹é¡µé¢åŠ è½½é€Ÿåº¦
            setTimeout(function() {
                loadExamData();
            }, 100);
        });

        // æ˜¾ç¤ºå…è´£å£°æ˜å¼¹çª—
        function showDisclaimerModal() {
            const modal = document.createElement('div');
            modal.id = 'disclaimerModal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg max-w-2xl mx-4 p-6 shadow-xl">
                    <div class="text-center mb-6">
                        <div class="text-4xl mb-2">âš ï¸</div>
                        <h2 class="text-xl font-bold text-gray-800">é‡è¦æé†’</h2>
                    </div>

                    <div class="space-y-4 text-gray-700 mb-6">
                        <div class="flex items-start">
                            <span class="text-red-500 mr-3 mt-1">â€¢</span>
                            <p>è¯¥å·¥å…·ä»…ä¸ºä¸ªäººå¼€å‘ä½¿ç”¨ï¼Œä»…ä¾›å‚è€ƒä½¿ç”¨ï¼Œä¸æ„æˆä»»ä½•å®˜æ–¹è€ƒè¯•å®‰æ’çš„æœ€ç»ˆä¾æ®ã€‚ä»…æ”¯æŒã€Šç”µä¿¡å­¦é™¢ã€‹è€ƒè¯•å®‰æ’æŸ¥è¯¢ã€‚</p>
                        </div>
                        <div class="flex items-start">
                            <span class="text-red-500 mr-3 mt-1">â€¢</span>
                            <p>è¯¥å·¥å…·ä½¿ç”¨Pythonç¨‹åºæå–Excelè¡¨æ ¼æ–‡ä»¶ï¼Œæ•°æ®å¤„ç†è¿‡ç¨‹ä¸­å¯èƒ½å­˜åœ¨è¯¯å·®æˆ–é—æ¼ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·ä»¥å­¦é™¢å®˜æ–¹ä¸‹å‘çš„è€ƒè¯•æ–‡ä»¶ä¸ºå‡†ã€‚</p>
                        </div>

                        <div class="flex items-start">
                            <span class="text-orange-500 mr-3 mt-1">â€¢</span>
                            <p>éƒ¨åˆ†é‡ä¿®ã€éšç­åŠç‰¹æ®Šè¯¾ç¨‹å¯èƒ½åœ¨æ•°æ®æå–é˜¶æ®µæœªèƒ½æ­£ç¡®è¯†åˆ«æˆ–åŠ è½½ã€‚å¦‚æ¶‰åŠæ­¤ç±»æƒ…å†µï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹å­¦é™¢å®˜æ–¹å‘å¸ƒçš„è€ƒè¯•å®‰æ’æ–‡ä»¶ã€‚</p>
                        </div>

                        <div class="flex items-start">
                            <span class="text-blue-500 mr-3 mt-1">â€¢</span>
                            <p>æœ¬å·¥å…·ä»…ä¾›å‚è€ƒä½¿ç”¨ï¼Œä¸æ„æˆä»»ä½•å®˜æ–¹è€ƒè¯•å®‰æ’çš„æœ€ç»ˆä¾æ®ã€‚è€ƒè¯•ç›¸å…³ä¿¡æ¯ä»¥å­¦æ ¡æ•™åŠ¡å¤„å’Œå„å­¦é™¢å®˜æ–¹ç½‘ç«™å…¬å¸ƒçš„ä¿¡æ¯ä¸ºå‡†ã€‚</p>
                        </div>
                    </div>

                    <div class="text-center">
                        <button id="confirmBtn" class="bg-indigo-600 text-white px-8 py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                            æˆ‘å·²é˜…è¯»å¹¶äº†è§£ï¼ˆ<span id="countdown">5</span>ç§’ï¼‰
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // å€’è®¡æ—¶é€»è¾‘
            let countdown = 5;
            const countdownEl = document.getElementById('countdown');
            const confirmBtn = document.getElementById('confirmBtn');
            confirmBtn.disabled = true;

            const timer = setInterval(() => {
                countdown--;
                countdownEl.textContent = countdown;

                if (countdown <= 0) {
                    clearInterval(timer);
                    confirmBtn.disabled = false;
                    confirmBtn.textContent = 'æˆ‘å·²é˜…è¯»å¹¶äº†è§£';
                }
            }, 1000);

            // ç¡®è®¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            confirmBtn.addEventListener('click', function() {
                modal.remove();
                // ç§»é™¤å¼¹çª—ï¼Œå…è®¸é¡µé¢æ­£å¸¸ä½¿ç”¨
            });

            // é˜²æ­¢ESCé”®å…³é—­å¼¹çª—
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    e.preventDefault();
                }
            }, { once: true });
        }

        // æ˜¾ç¤ºæŒ‡å®šé¡µé¢
        function showPage(pageId) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºæŒ‡å®šé¡µé¢
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;
            
            // æ›´æ–°å¯¼èˆªæ çŠ¶æ€
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-indigo-600', 'bg-indigo-50');
                btn.classList.add('text-gray-600');
            });
            
            if (pageId === 'home') {
                document.querySelectorAll('.nav-btn')[0].classList.remove('text-gray-600');
                document.querySelectorAll('.nav-btn')[0].classList.add('text-indigo-600', 'bg-indigo-50');
            } else if (pageId === 'search') {
                document.querySelectorAll('.nav-btn')[1].classList.remove('text-gray-600');
                document.querySelectorAll('.nav-btn')[1].classList.add('text-indigo-600', 'bg-indigo-50');
            }
        }

        // åŠ è½½è€ƒè¯•æ•°æ®
        function loadExamData() {
            showLoading(true);
            fetch('exam_data.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('æ•°æ®åŠ è½½å¤±è´¥');
                    }
                    return response.json();
                })
                .then(data => {
                    examData = data;
                    console.log('è€ƒè¯•æ•°æ®åŠ è½½æˆåŠŸï¼Œå…±', examData.length, 'ä¸ªè€ƒåœº');
                    initializeFilters(); // åˆå§‹åŒ–ç­›é€‰é€‰é¡¹
                    showLoading(false);

                    // æ¯æ¬¡åˆ·æ–°éƒ½æ˜¾ç¤ºå…è´£å£°æ˜å¼¹çª—
                    setTimeout(() => {
                        showDisclaimerModal();
                    }, 500);
                })
                .catch(error => {
                    console.error('åŠ è½½è€ƒè¯•æ•°æ®æ—¶å‡ºé”™:', error);
                    showLoading(false);
                    alert('æ— æ³•åŠ è½½è€ƒè¯•æ•°æ®ï¼Œè¯·ç¡®ä¿exam_data.jsonæ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®');
                });
        }

        // åŠ è½½ç»Ÿè®¡æ•°æ®
        function loadStats() {
            if (examData.length === 0) {
                alert('æ•°æ®å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•');
                return;
            }

            const statsContainer = document.getElementById('statsContainer');
            const statsContent = document.getElementById('statsContent');

            // è®¡ç®—è¯¦ç»†ç»Ÿè®¡æ•°æ®
            let totalStudents = 0;
            let totalClasses = new Set();
            let totalColleges = new Set();
            let courseStats = {};
            let collegeStats = {};
            let timeStats = {};

            examData.forEach(exam => {
                totalStudents += exam.å­¦ç”Ÿåˆ—è¡¨.length;
                // åˆ†å‰²ç­çº§åç§°ï¼ˆå¯èƒ½æœ‰å¤šä¸ªç­çº§ï¼‰
                const classes = exam.ç­çº§åç§°.split(';');
                classes.forEach(cls => totalClasses.add(cls.trim()));
                totalColleges.add(exam.å­¦é™¢åç§°);

                // è¯¾ç¨‹ç»Ÿè®¡
                const course = exam.è¯¾ç¨‹åç§° || 'æœªçŸ¥è¯¾ç¨‹';
                if (!courseStats[course]) courseStats[course] = { exams: 0, students: 0 };
                courseStats[course].exams++;
                courseStats[course].students += exam.å­¦ç”Ÿåˆ—è¡¨.length;

                // å­¦é™¢ç»Ÿè®¡
                const college = exam.å­¦é™¢åç§° || 'æœªçŸ¥å­¦é™¢';
                if (!collegeStats[college]) collegeStats[college] = { exams: 0, students: 0 };
                collegeStats[college].exams++;
                collegeStats[college].students += exam.å­¦ç”Ÿåˆ—è¡¨.length;

                // æ—¶é—´ç»Ÿè®¡
                const time = exam.è€ƒè¯•æ—¶é—´ || 'æœªçŸ¥æ—¶é—´';
                if (!timeStats[time]) timeStats[time] = { exams: 0, students: 0 };
                timeStats[time].exams++;
                timeStats[time].students += exam.å­¦ç”Ÿåˆ—è¡¨.length;
            });

            // æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡æ•°æ®
            let statsHTML = `
                <div class="grid md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 rounded-lg p-4 text-center">
                        <div class="text-3xl mb-2">ğŸ«</div>
                        <div class="text-2xl font-bold text-blue-600">${examData.length}</div>
                        <div class="text-gray-600">è€ƒåœºæ•°é‡</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 text-center">
                        <div class="text-3xl mb-2">ğŸ‘¨â€ğŸ“</div>
                        <div class="text-2xl font-bold text-green-600">${totalStudents}</div>
                        <div class="text-gray-600">å­¦ç”Ÿæ€»æ•°</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4 text-center">
                        <div class="text-3xl mb-2">ğŸ¢</div>
                        <div class="text-2xl font-bold text-purple-600">${totalColleges.size}</div>
                        <div class="text-gray-600">å­¦é™¢æ•°é‡</div>
                    </div>
                    <div class="bg-orange-50 rounded-lg p-4 text-center">
                        <div class="text-3xl mb-2">ğŸ“š</div>
                        <div class="text-2xl font-bold text-orange-600">${totalClasses.size}</div>
                        <div class="text-gray-600">ç­çº§æ•°é‡</div>
                    </div>
                </div>
            `;

            // è¯¾ç¨‹ç»Ÿè®¡
            statsHTML += '<div class="mb-6"><h4 class="text-lg font-semibold mb-3">ğŸ“š æŒ‰è¯¾ç¨‹ç»Ÿè®¡</h4><div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3">';
            Object.entries(courseStats).sort((a, b) => b[1].students - a[1].students).forEach(([course, data]) => {
                statsHTML += `
                    <div class="bg-white border rounded-lg p-3">
                        <div class="font-medium text-gray-800">${course}</div>
                        <div class="text-sm text-gray-600">${data.exams}ä¸ªè€ƒåœºï¼Œ${data.students}åå­¦ç”Ÿ</div>
                    </div>
                `;
            });
            statsHTML += '</div></div>';

            // å­¦é™¢ç»Ÿè®¡
            statsHTML += '<div class="mb-6"><h4 class="text-lg font-semibold mb-3">ğŸ¢ æŒ‰å­¦é™¢ç»Ÿè®¡</h4><div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3">';
            Object.entries(collegeStats).sort((a, b) => b[1].students - a[1].students).forEach(([college, data]) => {
                statsHTML += `
                    <div class="bg-white border rounded-lg p-3">
                        <div class="font-medium text-gray-800">${college}</div>
                        <div class="text-sm text-gray-600">${data.exams}ä¸ªè€ƒåœºï¼Œ${data.students}åå­¦ç”Ÿ</div>
                    </div>
                `;
            });
            statsHTML += '</div></div>';

            // æ—¶é—´ç»Ÿè®¡ï¼ˆåªæ˜¾ç¤ºå‰10ä¸ªæœ€å¸¸è§çš„ï¼‰
            const topTimes = Object.entries(timeStats).sort((a, b) => b[1].students - a[1].students).slice(0, 10);
            statsHTML += '<div><h4 class="text-lg font-semibold mb-3">â° æŒ‰è€ƒè¯•æ—¶é—´ç»Ÿè®¡ï¼ˆTop 10ï¼‰</h4><div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3">';
            topTimes.forEach(([time, data]) => {
                statsHTML += `
                    <div class="bg-white border rounded-lg p-3">
                        <div class="font-medium text-gray-800">${time}</div>
                        <div class="text-sm text-gray-600">${data.exams}ä¸ªè€ƒåœºï¼Œ${data.students}åå­¦ç”Ÿ</div>
                    </div>
                `;
            });
            statsHTML += '</div></div>';

            statsContent.innerHTML = statsHTML;
            statsContainer.classList.remove('hidden');
            statsContainer.classList.add('fade-in');
        }

        // æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯
        function searchStudent() {
            if (examData.length === 0) {
                alert('æ•°æ®å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•');
                return;
            }

            const nameInput = document.getElementById('nameInput').value.trim();
            const idInput = document.getElementById('idInput').value.trim();

            if (!nameInput || !idInput) {
                alert('è¯·è¾“å…¥å®Œæ•´çš„å§“åå’Œå­¦å·');
                return;
            }

            showLoading(true);

            // æŸ¥æ‰¾åŒ¹é…çš„å­¦ç”Ÿï¼ˆå§“åå’Œå­¦å·éƒ½å¿…é¡»ç²¾ç¡®åŒ¹é…ï¼‰
            const results = [];

            examData.forEach(exam => {
                exam.å­¦ç”Ÿåˆ—è¡¨.forEach(student => {
                    if (student.å§“å === nameInput && student.å­¦å· === idInput) {
                        results.push({
                            ...student,
                            è¯¾ç¨‹åç§°: exam.è¯¾ç¨‹åç§°,
                            // è€ƒè¯•åœ°ç‚¹å’Œè€ƒè¯•æ—¶é—´ä½¿ç”¨å­¦ç”Ÿåˆ—è¡¨ä¸­çš„æ•°æ®
                            è€ƒè¯•åœ°ç‚¹: student.è€ƒè¯•åœ°ç‚¹ || exam.è€ƒè¯•åœ°ç‚¹,
                            è€ƒè¯•æ—¶é—´: student.è€ƒè¯•æ—¶é—´ || exam.è€ƒè¯•æ—¶é—´,
                            å­¦é™¢åç§°: student.å­¦é™¢åç§° || exam.å­¦é™¢åç§°
                        });
                    }
                });
            });

            // æŒ‰ç…§è€ƒè¯•æ—¶é—´ä»è¿‘åˆ°è¿œæ’åº
            results.sort((a, b) => {
                const timeA = parseExamTime(a.è€ƒè¯•æ—¶é—´);
                const timeB = parseExamTime(b.è€ƒè¯•æ—¶é—´);
                return timeA - timeB; // ä»è¿‘åˆ°è¿œæ’åºï¼ˆå°çš„åœ¨å‰ï¼‰
            });

            // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
            displaySearchResults(results);
            showLoading(false);
        }

        // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
        function displaySearchResults(results) {
            const searchResults = document.getElementById('searchResults');
            const resultsContent = document.getElementById('resultsContent');
            
            if (results.length === 0) {
                resultsContent.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-6xl mb-4">ğŸ”</div>
                        <p class="text-gray-600 text-lg">æœªæ‰¾åˆ°åŒ¹é…çš„å­¦ç”Ÿä¿¡æ¯</p>
                        <p class="text-gray-500 mt-2">è¯·æ£€æŸ¥è¾“å…¥çš„å§“åæˆ–å­¦å·æ˜¯å¦æ­£ç¡®</p>
                    </div>
                `;
            } else {
                let html = '';
                results.forEach((student, index) => {
                    html += `
                        <div class="border-b border-gray-200 pb-4 mb-4 ${index === 0 ? '' : 'pt-4'}">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center mb-2">
                                        <span class="text-2xl mr-2">ğŸ‘¤</span>
                                        <h4 class="text-lg font-semibold text-gray-800">${student.å§“å}</h4>
                                        <span class="ml-3 px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded-full">åºå·${student.åºå·}</span>
                                    </div>
                                    <div class="grid md:grid-cols-2 gap-2 text-sm">
                                        <div class="flex items-center">
                                            <span class="text-gray-500 mr-2">ğŸ“:</span>
                                            <span class="text-gray-700">${student.å­¦å·}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="text-gray-500 mr-2">ğŸ«:</span>
                                            <span class="text-gray-700">${student.ç­çº§}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="text-gray-500 mr-2">ğŸ“š:</span>
                                            <span class="text-gray-700">${student.è¯¾ç¨‹åç§°}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="text-gray-500 mr-2">ğŸ“:</span>
                                            <span class="text-gray-700">${student.è€ƒè¯•åœ°ç‚¹}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="text-gray-500 mr-2">â°:</span>
                                            <span class="text-gray-700">${student.è€ƒè¯•æ—¶é—´}</span>
                                        </div>
                                        <div class="flex items-center">
                                            <span class="text-gray-500 mr-2">ğŸ¢:</span>
                                            <span class="text-gray-700">${student.å­¦é™¢åç§°}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                resultsContent.innerHTML = html;
            }
            
            searchResults.classList.remove('hidden');
            searchResults.classList.add('fade-in');
        }

        // ä¿å­˜ä¸ºå›¾ç‰‡
        function saveAsImage() {
            const searchResults = document.getElementById('searchResults');
            const resultsContent = document.getElementById('resultsContent');
            
            if (!resultsContent.innerHTML.trim()) {
                alert('æ²¡æœ‰å¯ä¿å­˜çš„æŸ¥è¯¢ç»“æœ');
                return;
            }
            
            showLoading(true);
            
            // åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„æ‰“å°å…ƒç´ 
            const printElement = document.getElementById('printElement');
            
            // è·å–å½“å‰æŸ¥è¯¢ç»“æœçš„æ ‡é¢˜å’Œæ•°æ®
            const titleElement = searchResults.querySelector('h3');
            const titleText = titleElement ? titleElement.textContent : 'æŸ¥è¯¢ç»“æœ';
            
            // æ„å»ºæ‰“å°å†…å®¹çš„HTMLï¼Œä½¿ç”¨å†…è”æ ·å¼ç¡®ä¿æ ·å¼æ­£ç¡®
            let printHTML = `
                <div style="background-color: #ffffff; color: #000000; padding: 20px; font-family: Arial, sans-serif; border-radius: 8px;">
                    <h2 style="color: #000000; font-size: 24px; font-weight: bold; margin-bottom: 20px; border-bottom: 2px solid #000000; padding-bottom: 10px;">
                        ğŸ“‹ ${titleText}
                    </h2>
                    <div style="color: #000000;">
            `;
            
            // è·å–æ‰€æœ‰å­¦ç”Ÿç»“æœ
            const studentCards = resultsContent.querySelectorAll('div[class*="border-b"]');
            
            if (studentCards.length === 0) {
                // å¦‚æœæ²¡æœ‰ç»“æœï¼Œæ˜¾ç¤ºæ— ç»“æœæ¶ˆæ¯
                printHTML += `
                    <div style="text-align: center; padding: 40px; color: #000000;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ”</div>
                        <p style="font-size: 18px; color: #000000;">æœªæ‰¾åˆ°åŒ¹é…çš„å­¦ç”Ÿä¿¡æ¯</p>
                        <p style="font-size: 16px; color: #000000; margin-top: 10px;">è¯·æ£€æŸ¥è¾“å…¥çš„å§“åæˆ–å­¦å·æ˜¯å¦æ­£ç¡®</p>
                    </div>
                `;
            } else {
                // æ·»åŠ æ¯ä¸ªå­¦ç”Ÿçš„ä¿¡æ¯
                studentCards.forEach((card, index) => {
                    const nameElement = card.querySelector('h4');
                    const name = nameElement ? nameElement.textContent : '';
                    
                    // è·å–æ‰€æœ‰ä¿¡æ¯è¡Œ
                    const infoRows = card.querySelectorAll('div[class*="flex items-center"]');
                    let studentInfo = '';
                    
                    infoRows.forEach(row => {
                        const iconSpan = row.querySelector('span');
                        const textSpan = row.querySelector('span:last-child');
                        
                        if (iconSpan && textSpan) {
                            const icon = iconSpan.textContent;
                            const text = textSpan.textContent;
                            studentInfo += `
                                <div style="margin-bottom: 8px; color: #000000;">
                                    <span style="margin-right: 8px;">${icon}</span>
                                    <span style="color: #000000; font-weight: normal;">${text}</span>
                                </div>
                            `;
                        }
                    });
                    
                    printHTML += `
                        <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #000000;">
                            <div style="display: flex; align-items: center; margin-bottom: 15px; color: #000000;">
                                <span style="font-size: 24px; margin-right: 10px;">ğŸ‘¤</span>
                                <h3 style="color: #000000; font-size: 18px; font-weight: bold; margin: 0;">${name}</h3>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; color: #000000;">
                                ${studentInfo}
                            </div>
                        </div>
                    `;
                });
            }
            
            // æ·»åŠ é¡µè„š
            printHTML += `
                    </div>
                    <div style="margin-top: 30px; text-align: center; font-size: 12px; color: #666; border-top: 1px solid #ccc; padding-top: 10px;">
                        è€ƒè¯•ç­¾åˆ°æŸ¥è¯¢ç³»ç»Ÿ - ${new Date().toLocaleDateString()}
                    </div>
                </div>
            `;
            
            // å°†HTMLè®¾ç½®åˆ°æ‰“å°å…ƒç´ 
            printElement.innerHTML = printHTML;
            
            // æ˜¾ç¤ºæ‰“å°å…ƒç´ ï¼ˆä¸´æ—¶ï¼‰
            printElement.classList.remove('hidden');
            printElement.style.position = 'absolute';
            printElement.style.left = '-9999px';
            printElement.style.top = '0';
            printElement.style.width = '800px';
            
            // ä½¿ç”¨html2canvasæ•è·æ‰“å°å…ƒç´ 
            html2canvas(printElement, {
                backgroundColor: '#ffffff',
                scale: 2,
                logging: false,
                width: 800,
                height: printElement.scrollHeight,
                windowWidth: 800,
                windowHeight: printElement.scrollHeight
            }).then(canvas => {
                // éšè—æ‰“å°å…ƒç´ 
                printElement.classList.add('hidden');
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const link = document.createElement('a');
                link.download = `è€ƒè¯•æŸ¥è¯¢ç»“æœ_${new Date().toLocaleDateString()}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
                
                showLoading(false);
            }).catch(error => {
                console.error('ä¿å­˜å›¾ç‰‡æ—¶å‡ºé”™:', error);
                // éšè—æ‰“å°å…ƒç´ 
                printElement.classList.add('hidden');
                alert('ä¿å­˜å›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•');
                showLoading(false);
            });
        }

        /*
        // å¯¼å‡ºä¸ºCSV - æš‚æ—¶æ³¨é‡Šæ‰æ­¤åŠŸèƒ½
        function exportToCSV() {
            // æ­¤åŠŸèƒ½å·²æš‚æ—¶ç¦ç”¨ï¼Œå¦‚éœ€æ¢å¤è¯·å–æ¶ˆæ³¨é‡Š
        }
        */

        // æ˜¾ç¤º/éšè—åŠ è½½æç¤º
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        // ç›‘å¬å›è½¦é”®è¿›è¡ŒæŸ¥è¯¢
        document.getElementById('nameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStudent();
            }
        });
        document.getElementById('idInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStudent();
            }
        });

        // åˆå§‹åŒ–ç­›é€‰é€‰é¡¹
        function initializeFilters() {
            if (examData.length === 0) return;

            const courseFilter = document.getElementById('courseFilter');
            const collegeFilter = document.getElementById('collegeFilter');
            const timeFilter = document.getElementById('timeFilter');

            // æ”¶é›†æ‰€æœ‰è¯¾ç¨‹ã€å­¦é™¢ã€æ—¶é—´é€‰é¡¹
            const courses = new Set();
            const colleges = new Set();
            const times = new Set();

            examData.forEach(exam => {
                if (exam.è¯¾ç¨‹åç§°) courses.add(exam.è¯¾ç¨‹åç§°);
                if (exam.å­¦é™¢åç§°) colleges.add(exam.å­¦é™¢åç§°);
                if (exam.è€ƒè¯•æ—¶é—´) times.add(exam.è€ƒè¯•æ—¶é—´);
            });

            // å¡«å……ç­›é€‰é€‰é¡¹
            Array.from(courses).sort().forEach(course => {
                const option = document.createElement('option');
                option.value = course;
                option.textContent = course;
                courseFilter.appendChild(option);
            });

            Array.from(colleges).sort().forEach(college => {
                const option = document.createElement('option');
                option.value = college;
                option.textContent = college;
                collegeFilter.appendChild(option);
            });

            Array.from(times).sort().forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = time;
                timeFilter.appendChild(option);
            });
        }

        // åˆ‡æ¢é«˜çº§ç­›é€‰æ˜¾ç¤º
        function toggleFilters() {
            const filters = document.getElementById('advancedFilters');
            const isHidden = filters.classList.contains('hidden');

            if (isHidden) {
                filters.classList.remove('hidden');
                filters.classList.add('fade-in');
                if (examData.length > 0) {
                    initializeFilters();
                }
            } else {
                filters.classList.add('hidden');
            }
        }

        // åº”ç”¨ç­›é€‰
        function applyFilters() {
            const courseFilter = document.getElementById('courseFilter').value;
            const collegeFilter = document.getElementById('collegeFilter').value;
            const timeFilter = document.getElementById('timeFilter').value;

            // ç­›é€‰æ•°æ®
            let filteredData = examData;

            if (courseFilter) {
                filteredData = filteredData.filter(exam => exam.è¯¾ç¨‹åç§° === courseFilter);
            }

            if (collegeFilter) {
                filteredData = filteredData.filter(exam => exam.å­¦é™¢åç§° === collegeFilter);
            }

            if (timeFilter) {
                filteredData = filteredData.filter(exam => exam.è€ƒè¯•æ—¶é—´ === timeFilter);
            }

            // æ˜¾ç¤ºç­›é€‰ç»“æœ
            displayFilteredResults(filteredData, courseFilter, collegeFilter, timeFilter);
        }

        // æ˜¾ç¤ºç­›é€‰ç»“æœ
        function displayFilteredResults(filteredData, courseFilter, collegeFilter, timeFilter) {
            const searchResults = document.getElementById('searchResults');
            const resultsContent = document.getElementById('resultsContent');

            // æŒ‰ç…§è€ƒè¯•æ—¶é—´ä»è¿‘åˆ°è¿œæ’åº
            filteredData.sort((a, b) => {
                const timeA = parseExamTime(a.è€ƒè¯•æ—¶é—´);
                const timeB = parseExamTime(b.è€ƒè¯•æ—¶é—´);
                return timeA - timeB; // ä»è¿‘åˆ°è¿œæ’åºï¼ˆå°çš„åœ¨å‰ï¼‰
            });

            let totalStudents = 0;
            filteredData.forEach(exam => totalStudents += exam.å­¦ç”Ÿåˆ—è¡¨.length);

            let html = `
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <span class="text-blue-400">ğŸ“Š</span>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-blue-700">
                                ç­›é€‰ç»“æœï¼šæ‰¾åˆ° ${filteredData.length} ä¸ªè€ƒåœºï¼Œå…± ${totalStudents} åå­¦ç”Ÿ
                                ${courseFilter ? `<br>è¯¾ç¨‹ï¼š${courseFilter}` : ''}
                                ${collegeFilter ? `<br>å­¦é™¢ï¼š${collegeFilter}` : ''}
                                ${timeFilter ? `<br>è€ƒè¯•æ—¶é—´ï¼š${timeFilter}` : ''}
                            </p>
                        </div>
                    </div>
                </div>
            `;

            if (filteredData.length === 0) {
                html += `
                    <div class="text-center py-8">
                        <div class="text-6xl mb-4">ğŸ”</div>
                        <p class="text-gray-600 text-lg">æœªæ‰¾åˆ°åŒ¹é…çš„è€ƒåœºä¿¡æ¯</p>
                        <p class="text-gray-500 mt-2">è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶åé‡è¯•</p>
                    </div>
                `;
            } else {
                // æ˜¾ç¤ºå‰20ä¸ªè€ƒåœºçš„æ‘˜è¦ä¿¡æ¯
                html += '<div class="space-y-3">';
                filteredData.slice(0, 20).forEach((exam, index) => {
                    html += `
                        <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-800">${exam.è¯¾ç¨‹åç§° || 'æœªçŸ¥è¯¾ç¨‹'}</h4>
                                    <div class="text-sm text-gray-600 mt-1">
                                        <span class="mr-4">ğŸ“ ${exam.è€ƒè¯•åœ°ç‚¹ || 'æœªçŸ¥åœ°ç‚¹'}</span>
                                        <span class="mr-4">â° ${exam.è€ƒè¯•æ—¶é—´ || 'æœªçŸ¥æ—¶é—´'}</span>
                                        <span>ğŸ‘¥ ${exam.å­¦ç”Ÿåˆ—è¡¨.length}åå­¦ç”Ÿ</span>
                                    </div>
                                    <div class="text-sm text-gray-500 mt-1">
                                        ğŸ¢ ${exam.å­¦é™¢åç§° || 'æœªçŸ¥å­¦é™¢'} | ğŸ“š ${exam.ç­çº§åç§° || 'æœªçŸ¥ç­çº§'}
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded-full">
                                        è€ƒåœº ${index + 1}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                });

                if (filteredData.length > 20) {
                    html += `
                        <div class="text-center py-4">
                            <p class="text-gray-500">... è¿˜æœ‰ ${filteredData.length - 20} ä¸ªè€ƒåœº</p>
                        </div>
                    `;
                }
                html += '</div>';
            }

            resultsContent.innerHTML = html;
            searchResults.classList.remove('hidden');
            searchResults.classList.add('fade-in');
        }

        // æ¸…é™¤ç­›é€‰
        function clearFilters() {
            document.getElementById('courseFilter').value = '';
            document.getElementById('collegeFilter').value = '';
            document.getElementById('timeFilter').value = '';
            document.getElementById('searchResults').classList.add('hidden');
        }
    </script>
</body>
</html>
